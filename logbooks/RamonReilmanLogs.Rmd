---
title: "Logbook Ramon Reilman"
author: "Ramon Reilman"
date: "2024-09-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Logboek Ramon Reilman

## 10-9-2024
Bezig geweest met verschillende literatuur onderzoeken lezen.
Met de groep 1 van de door ons ingestuurde literatuur onderzoeken gekozen.

## 11-9-2024
Voor plan van aanpak en het nabootsen van het artikel moet er bekend zijn welke tools gebruikt zijn door het artikel.
Ik ben begonnen met dit uitzoeken door het artikel en dan vooral materiaal en methode te gaan lezen en verwerken.

## 12-9-2024
Vandaag verder gegaan met de gebruikte tools opsporen. Ook heb ik gekeken wat voor type sequencing toegepast is (WES) en met welke sequencer (Illumina HiSeq 2500). Alle gebruikte tools zijn gevonden en wat ze doen ook.


- Burrows-Wheeler Aligner, voor de aligning van het DNA tegen het referentie genoom.
- Picard, Het verwijderen van duplicaten en sorteren
- Strelka, voor het vinden van mutaties
- snpEff, informatie/impact van de mutaties op eiwitten

Nu kunnen we bezig met de tools verder uitzoeken en hun documentatie/installatie lezen.

## 13-9-2024
Dataset is gedownload naar de remote server,
dit is uitgevoerd met het volgende command in bash:
```{bash, eval=FALSE}
prefetch $(</students/2024-2025/Thema05/BlaasKanker/SRR_Acc_List.txt) --output-directory \
 /students/2024-2025/Thema05/BlaasKanker/SRA/ --max-size 200G

```

Nu staat de data gedownload op de school server zodat we bezig kunnen met quality controle.

Verder bezig geweest met presentatie van het plan van aanpak voorbereiden.
Het lezen van de tools, en gebruik hiervan begrijpen.

## 14-9-2024
Plan van aanpak deadline dag,
alle git branches zijn gemerged nadat feedback is gegeven en dit is aangepast.
Daarna zijn alle kopjes samengevoegd naar 1 bestand en deze is geknit tot pdf.

Janine heeft haar enkel gebroken, zal de presentatie missen en ik moet haar stukje last moment opvangen.

## 15-9-2024
De presentatie van het plan van aanpak is gemaakt.
Na nog wat feedback van de groepsgenoten is de achtergrond informatie iets meer uitgebreid. Ook zijn spelfoutjes verwijderd en is de workflow flowchart een beetje aangepast (van nederlands naar engels).

## 16-9-2024
Presentatie van plan van aanpak gedaan.
Daarna zijn we bezig geweest met het "uitpakken" van de gedownloade SRR bestanden, dit moet omdat deze gecomprimeerd zijn.
Dit is gedaan met het volgende bash command.

```{bash , eval=FALSE}
find /students/2024-2025/Thema05/BlaasKanker/SRA/ -name "*.sra" | \
  parallel fasterq-dump -O /students/2024-2025/Thema05/BlaasKanker/fastq/ {}
```


Thuis ben ik bezig geweest met het kijken en proberen van testdata maken.
Testdata moet gemaakt worden om tools/commands te testen zonder dat deze uren, misschien wel dagen moeten draaien voordat ze een foutmelding geven.

De docent heeft ons verteld dat deze testdata gemaakt moet worden met seqkit split2
ik heb vervolgens een command gemaakt die dit gebruikt:

```{bash, eval=FALSE}
find /students/2024-2025/Thema05/BlaasKanker/fastq/ -name "*.fastq" -printf "%f\n" | \
  parallel seqkit split2 -O /students/2024-2025/Thema05/BlaasKanker/testdata/ -s 10000 -f {}
```

Het enige probleem met deze methode is dat het de fastq bestanden split op de -s N.
als een fastq file dan een miljoen reads heeft krijg je 1.000.000 / 10.000 bestanden. Niet heel praktisch.

Nadat ik de documentatie van seqkit heb gelezen kwam ik uit bij seqkit sample.
seqkit sample bij het meegeven van een -n argument laad het hele fastq bestand in het geheugen, dat is onhandig bij hele grote fastq bestanden.

Op de website stond een methode die meer geheugen vriendelijk is, en hiermee heb ik een bash command gemaakt:

```{data, eval=FALSE}
find /students/2024-2025/Thema05/BlaasKanker/fastq/ -name "*.fastq" | \
  parallel "seqkit sample -p 0.1 {} | seqkit head -n 10000 > /students/2024-2025/Thema05/BlaasKanker/testdata/{/}"
```

Deze maakt testdata, van elk bestand 10.000 sequenties.

## 17-9-2024

Vandaag hebben wij een fastqc en multiqc uitgevoerd op onze test data.
Dit is gedaan om te bepalen wat de kwaliteit is van onze data. En met deze informatie kan er met Trimmomatic de kwaliteit van de data verbeterd worden.

```{bash, eval=FALSE}
fastqc /students/2024-2025/Thema05/BlaasKanker/testdata/* -o /students/2024-2025/Thema05/BlaasKanker/testingtools/fastqc/ -t 10
```

```{bash, eval=FALSE}
multiqc /students/2024-2025/Thema05/BlaasKanker/testingtools/fastqc/* -o /students/2024-2025/Thema05/BlaasKanker/testingtools/multiqc
```

Uit de plotjes bleek het volgende:
De kwaliteit van de sequenties was goed, bij het begin en einde een beetje lager dan het midden, zoals verwacht.
Er zijn wel veel duplicaten, wat mogelijk kan komen doordat het een whole exome sequencing is, maar hier ga ik later onderzoek naar doen.

Verder heb ik deze dag en les Jasper en Iris geholpen met het uitvoeren van een fastqc en multiqc op onze data.

## 18-9-2024
Vandaag is gekeken naar de documentatie van Trimmomatic, ook heeft de docent er wat over uitgelegd.

We hebben een adapterfile gedownload om adapters uit onze sequenties te knippen.
En we hebben een Trimmomatic uitgevoerd, de settings hadden we gekregen van de docent. Deze settings hebben wij niet aangepast, om te kijken wat het doet op onze data.

```{bash, eval=FALSE}
cat /students/2024-2025/Thema05/BlaasKanker/SRR_Acc_List.txt | \
  parallel 'TrimmomaticPE -threads 8' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/testingtools/testing_trim/{}_paired.1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/testingtools/testing_trim/{}_unpaired.1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/testingtools/testing_trim/{}_paired.2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/testingtools/testing_trim/{}_unpaired.2.fastq' \
                  'ILLUMINACLIP:/students/2024-2025/Thema05/BlaasKanker/tools/trim_adapters/TruSeq3-PE.fa:2:30:10' \
                  'LEADING:3' \
                  'TRAILING:3' \
                  'MINLEN:40 ' \
                  'SLIDINGWINDOW:4:20'
```
Hierna is een fastqc en multiqc uitgevoerd, en het bleek dat de kwaliteit van onze data verslechterd is. Op alle vlakken.
Wij begrepen niet waarom, dus hebben wat settings weggehaald en het opnieuw uitgevoerd met andere settings.

```{bash, eval=FALSE}
cat /students/2024-2025/Thema05/BlaasKanker/SRR_Acc_List.txt | \
  parallel 'TrimmomaticPE -threads 10' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/minlen_20/{}_paired.1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/minlen_20/{}_unpaired.1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/minlen_20/{}_paired.2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/minlen_20/{}_unpaired.2.fastq' \
                  'ILLUMINACLIP:/students/2024-2025/Thema05/BlaasKanker/tools/trim_adapters/TruSeq3-PE.fa:2:30:10' \
                  'MINLEN:20'
```
Het uitvoeren van Trimmomatic, zelfs op data van 10.000 sequenties duurde ontzettend lang. Wij begrijpen niet waarom.

De unpaired bestanden hadden 0 sequenties nadat we het met deze settings hebben uitgevoerd.
De unpaired bestanden die Trimmomatic maakt bevatten de sequenties van of de reverse of forward, waarbij de andere de kwaliteits controle niet gered heeft.


## 20-09-2024
Vandaag hebben wij aan de docent gevraagd hoe het dan dat de data een minder goede kwaliteit geeft.
Wij hebben de tip gekregen om goed na te denken over de settings, en goed de plotjes lezen van multiqc.
Op advies van de docent hebben we de testdata verhoogd naar 500.000 sequenties, zodat het ook tijdens het mappen duidelijker leesbaar wordt.

## 21-09-2024
Ik heb de plotjes gelezen van fastqc en multiqc, en heb op basis van dit nieuwe Trimmomatic experimenten uitgevoerd.


Ik wil trimmomatic uitvoeren die adapters weghaalt, een slidingwindow heeft van 4:20, en een minlen van 20. Ik voer deze uit om te kijken hoe deze settings samen invloed heeft op de testdata in vergelijking tot de ongetrimde data.

| Run ID  | LEADING | TRAILING | SLIDING WINDOW | MINLEN | AVGQUAL | HEADCROP | CROP | ILLUMINACLIP |
|---------|---------|----------|----------------|--------|---------|----------|------|--------------|
| A4:20ML20 | NONE    | NONE        | 4:20           | 20   | NONE    | NONE     | TruSeq3-PE.fa |          |
|         |         |          |                |        |         |          |      |              |
|         |         |          |                |        |         |          |      |              |

Na een korte controle bleek onze adapter file niet goed te zijn, dit was door onbekende redenen een html file. Dit kan eventueel verklaren waarom het zo lang duurde om Trimmomatic uit te voeren.
```{bash, eval=FALSE}
cat /students/2024-2025/Thema05/BlaasKanker/SRR_Acc_List.txt | \
  parallel 'TrimmomaticPE -threads 12' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/trimmed_data/{}_paired.1.fastq ' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/trimmed_data/{}_unpaired.1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/trimmed_data/{}_paired.2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/trimmed_data/{}_unpaired.2.fastq' \
                  'ILLUMINACLIP:/students/2024-2025/Thema05/BlaasKanker/tools/trim_adapters/TruSeq3-PE.fa:2:30:10' \
                  'MINLEN:20' \
                  'SLIDINGWINDOW:4:20'
```

Na het trimmen is de data met fastqc en multiqc verwerkt naar een webpagina met duidelijk leesbare plotjes.

```{bash, eval=FALSE}
fastqc /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/trimmed_data/* -o /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/fastqc -t 12

multiqc /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/fastqc* -o \
  /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/multiqc
```

Als ik kijk naar onze test data ongetrimmed ziet dat er erg goed uit.
het GC% ligt bij alle bestanden rond de 45% zoals verwacht. De kwaliteit is goed, behalve aan het begin en einde, zoals verwacht.
Er zijn geen waarschuwingen, of adapters gevonden. Dit laat mij denken dat we mogelijk de adapter optie weg kunnen laten.

Als ik vervolgens kijk naar de getrimmde data valt mij een aantal dingen op.
Er zijn 2 soorten output: paired en unpaired.
het aantal sequenties van paired is velen malen hoger dan de unpaired files.
Na het opzoeken wat deze files zijn kwam ik op het volgende:
De .paired bestanden zijn bestanden waarin zowel de forward als reverse sequentie goed gekeurd zijn door Trimmomatics.
De .unpaired bestanden hebben de sequenties waarvan alleen dat bijpassende bestand goed gekeurd is door Trimmomatics.

Deze .unpaired bestanden hebben best wel een invloed op onze multiqc output, dus zal ik een multiqc uitvoeren op alleen de paired data.
Voor het onderzoek downstream lijkt mij het beste om mogelijk ook de unpaired sequenties achter te laten. Dit zijn nu single end sequenties die een stuk lastiger zijn om te mappen.

/ TODO voer multiqc uit op alleen de getrimde paired data
## 22-09-2024
```{bash, eval=FALSE}
fastqc /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/trimmed_data/*_paired.* -o /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/output/fastqc_no_unpaired -t 12

multiqc /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/output/fastqc_no_unpaired/* -o \
  /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_20_ML20/output/multiqc_no_unpaired
```
De kwaliteit is niet veel verbeterd.

Het is goed om nu een stap terug te nemen en kijken naar de ongetrimde data.
Welke dingen kunnen verbeterd worden en welke trimmomatic settings kunnen hiervoor gebruikt worden?

Aan het begin en einde van de sequences is een verlaging van kwaliteit, deze is verwacht. Dit kan verwijderd worden door leading en triailing. Over de sequenties zijn een paar dips in kwaliteit zichtbaar, dit kan verwijderd worden door de sliding window.
Na het verwijderen is kan ik nog een MINLEN van 30, zodat de hele kleine sequenties verwijderd worden.
Adapter verwijderen is niet nodig, omdat er geen adapters gedetecteerd worden.

| Run ID  | LEADING | TRAILING | SLIDING WINDOW | MINLEN | AVGQUAL | HEADCROP | CROP | ILLUMINACLIP |
|---------|---------|----------|----------------|--------|---------|----------|------|--------------|
| A4:20ML20 | NONE    | NONE        | 4:20           | 20   | NONE    | NONE     | TruSeq3-PE.fa |          |
|     A4:32ML30L34T35 | 34         |  35        | 4:32               | 30        |  NONE       |  NONE        | NONE     |              |
|         |         |          |                |        |         |          |      |              |

```{bash, eval=FALSE}
cat /students/2024-2025/Thema05/BlaasKanker/SRR_Acc_List.txt | \
  parallel 'TrimmomaticPE -threads 12' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML30_L34_T35/trimmed_data/{}_paired.1.fastq ' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML30_L34_T35/trimmed_data/{}_unpaired.1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML30_L34_T35/trimmed_data/{}_paired.2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML30_L34_T35/trimmed_data/{}_unpaired.2.fastq' \
                  'LEADING:34' \
                  'SLIDINGWINDOW:4:32' \
                  'TRAILING:35' \
                  'MINLEN:30'
```

## 22-09-2024
```{bash, eval=FALSE}
fastqc /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML30_L34_T35/trimmed_data/*_paired.* -o /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML30_L34_T35/output/fastqc -t 12

multiqc /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML30_L34_T35/output/fastqc/* -o \
  /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML30_L34_T35/output/multiqc
```

De kwaliteit van de sequentie is nu een zo goed als rechte lijn met een phred score van rond de 37. De kans dat een nucleotide nu fout is is 0.000199526% (https://eafyounian.github.io/phred_score_converter/).
Het enige wat nu niet goed is is de distributie van de lengte.


## 23-09-2024


De kwaliteit is nu goed, alleen de verdeling van de lengtes van de sequenties is niet goed, al weet ik niet wat de oorzaak is.
Om te kijken of er verbetering is voer ik hetzelfde command uit met een hogere minlen.

| Run ID  | LEADING | TRAILING | SLIDING WINDOW | MINLEN | AVGQUAL | HEADCROP | CROP | ILLUMINACLIP |
|---------|---------|----------|----------------|--------|---------|----------|------|--------------|
| A4:20ML20 | NONE    | NONE        | 4:20           | 20   | NONE    | NONE     | TruSeq3-PE.fa |          |
|     A4:32ML30L34T35 | 34         |  35        | 4:32               | 30        |  NONE       |  NONE        | NONE     |              |
|     A4:32ML50L34T35 | 34         |  35        | 4:32               | 50        |  NONE       |  NONE        | NONE     |              |
|         |         |          |                |        |         |          |      |              |


```{bash, eval=FALSE}
cat /students/2024-2025/Thema05/BlaasKanker/SRR_Acc_List.txt | \
  parallel 'TrimmomaticPE -threads 12' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/testdata/{}_2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML50_L34_T35/trimmed_data/{}_paired.1.fastq ' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML50_L34_T35/trimmed_data/{}_unpaired.1.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML50_L34_T35/trimmed_data/{}_paired.2.fastq' \
                  '/students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML50_L34_T35/trimmed_data/{}_unpaired.2.fastq' \
                  'LEADING:34' \
                  'SLIDINGWINDOW:4:32' \
                  'TRAILING:35' \
                  'MINLEN:50'
```

## 22-09-2024
```{bash, eval=FALSE}
fastqc /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML50_L34_T35/trimmed_data/*_paired.* -o /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML50_L34_T35/output/fastqc -t 12

multiqc /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML50_L34_T35/output/fastqc/* -o \
  /students/2024-2025/Thema05/BlaasKanker/trimmingtesting/A4_32_ML50_L34_T35/output/multiqc
```
Hieruit blijkt nogsteeds een incorrecte verdeling te zijn van de lengtes van sequenties. Ik zal ergens deze week vragen naar een oplossing hiervoor.

## 23-09-2024
Vandaag zijn we bezig geweest met het mappen via bwa, zie hiervoor Jasper zijn logboek.

Ik ben daarnaast bezig geweest met het installeren van Strelka.
Strelka is een software die wij gaan gebruiken om varianten te vinden in onze data.
Deze staat niet standaard op de server, dus zal ik handmatig moeten installeren.
### Strelka installeren
Download the strelka git:
```{bash, eval=FALSE}
wget "https://github.com/Illumina/strelka/releases/download/v2.9.10/strelka-2.9.10.centos6_x86_64.tar.bz2"
tar xvjf strelka-2.9.10.centos6_x86_64.tar.bz2
```

Er wordt aangeraden om te testen of de software werkt
```{bash, eval=FALSE}
bash strelka-2.9.10.centos6_x86_64/bin/runStrelkaSomaticWorkflowDemo.bash
```
Hieruit blijkt dat ik python2 nodig heb.

Na korte research heb ik gevonden dat ik python versies lokaal kan installeren met pyenv.

```{bash, eval=FALSE}
git clone https://github.com/pyenv/pyenv.git
```

Nu staat pyenv in onze tools folder, en kan deze gebruikt worden om andere python versies te installeren.
1 groot probleem is dat pyenv in de gebruikers home dingen installeerd, dat wil ik niet aangezien de home folder maar 25 gigabytes mag zijn.
Ik moet in mijn ~/.bashrc bestand dus een andere locatie aangeven voor pyenv.

```{bash, eval=FALSE}
export PYENV_ROOT="/students/2024-2025/Thema05/BlaasKanker/tools/python_versies"
export PATH="$PYENV_ROOT/bin:$PATH"

eval "$(/students/2024-2025/Thema05/BlaasKanker/tools/pyenv/bin/pyenv init --path)"
export PYENV_CACHE_PATH="/students/2024-2025/Thema05/BlaasKanker/tools/.pyenvcache/"
```

Op deze manier kan ik een dir meegeven waar ik de versies wil hebben.
Nu kan ik een python versie installeren.

```{bash, eval=FALSE}
/students/2024-2025/Thema05/BlaasKanker/tools/pyenv/bin/pyenv install 2.7
/students/2024-2025/Thema05/BlaasKanker/tools/pyenv/bin/pyenv global 2.7
pip2.7 install virtualenv
python2.7 -m virtualenv strelkaVENV
```

Nu hebben we een virtualenv van python 2.7 in onze tools folder.
Hier kunnen we de benodigde pakketjes installeren, die ook gebruikt kunnen worden door mijn groeps genoten.
